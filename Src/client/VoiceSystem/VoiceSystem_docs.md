
# Задачи:

1. Голосовое общение
1.1 Менеджмент системы: бессознанка и кляпы запрещают общение
1.2 


2. Радиообщение
2.1 Понятие алгоритма обмена информацией
2.2 Возможность использования рации в руках
2.3 Возможность использования рации в мире
	2.3.1 Воспроизведение звука на источниках
	2.3.2 Источники на приём слышат голос игроков



# Заметки:

Активация рации делается через 
[""
format["TANGENT	PRESSED	%1%2	%3	%4", _freq, _radio call TFAR_fnc_getSwRadioCode, getNumber(configFile >> "CfgWeapons" >> _radio >> "tf_range") * (call TFAR_fnc_getTransmittingDistanceMultiplicator), getText(configFile >> "CfgWeapons" >> _radio >> "tf_subtype")],
-1
] call TFAR_fnc_ProcessTangent;
TANGENT [PRESSED | RELEASED]
Параметры: 
	частота на которой говорят, 
	радиокод (из настроек (определённых в TFAR_fnc_getSwSettings) выбиваем TF_CODE_OFFSET)
	Дистанция (как что где не понятно пока) -> Range of transmission for vehicle-mounted radio
	подтип рации: Подтип радио – влияет на эффекты DSP. Допустимые значения – digital_lr, digital, airborne
	
	
	Настройки (в нашем случае для св раций выглядят в формате)
	ARRAY: Settings [
		0: NUMBER - Active channel, 
		1: NUMBER - Volume, 
		2: ARRAY - Frequencies for channels, 
		3: NUMBER - Stereo setting, 
		4: STRING - Encryption code, 
		5: NUMBER - Additional active channel, 
		6: NUMBER - Additional active channel stereo mode, 
		7: OBJECT - Owner; 
		8: NUMBER - Speaker mode
		]

Внешние рации на земле и спикерные на юните хранятся каждый кадр в vs_speakerRadios

Элементы разделены vs_new_line:
Из исходников: radio_id,nickname,pos,volume,vehicle,(waveZ)
	айди рации (уникальная строка)
	частота рации (там мы вбиваем любое число)
		частота и кодировка. Может быть дополнено additionalChannel. P.s. из доков может быть больше двух доп.частот
	ник игрока (если пустая строка то это радио на земле)
	позиция (если пустой массив значит радио в игроке)
	громкость звука
	айди транспорта (если не транспорт то ставится "no"). 
		Выдаётся из netid + прочерк + уровень изоляции конфига (tf_isolatedAmount)
		Целиком выглядит как 3:2_40. В сингле netid: singleplayer_40
	Высота над уровнем моря. Должно быть больше vs_underwaterRadioDepth. позиция от asl


TFAR_fnc_preparePositionCoordinates
подготавливает запрос pos от юнита

 //POS 
 	nickname 
	[x,y,z] 
	[viewdirUnitvector(x,y,z)] 
	canSpeak - призраки слышат живых. живые не слышат призраков
	canUseSWRadio 
	canUseLRRadio 
	canUseDDRadio 
	vehicleID 
	terrainInterception 
	voiceVolume 
	objectInterception
	
Функционал
	- говорить +
	- слышать рации (синхронизация по сети)
	- говорить по рации в руках
	- говорить по рации на земле (через расстояние дублируем конфиг рации юниту)
	
	- понятие переменных
		TANGENT - событие указывает что локальный игрок начинает вещание в канал
		SPEAKERS - собирает рации которые будут выводить звук. Параметры:
			айди, 
			частота передачи
			указатель отправителя: если пустая строка то на земле -> тогда след. токен позиция ИЛИ пустой массив в случае если юнит
				И как раз эта переменная отвечает за то, рация в игроке или на земле!
			позиция относительно локального плеера
			громкость передачи
			транспорт (всегда no)
			позиция asl объекта передачи
			
			vs_speakerRadios - это радиостанции, передаваемые людьми, которые находятся на громкоговорителе
		FREQ - Уведомляет плагин о радиостанциях, используемых в настоящее время плеером, и различных настройках, активных на радио.
			Вызывается только для локального юнита.
			Нужен для того, чтобы понимать какие рации есть у плеера
		POS - готовит просто позиционную информацию каждого юнита. Громкость голоса, эффекты и тд.
		
		(ПРОВЕРЕНО)
		Если я всё правильно разрулил, то для добавления общения между двумя пидорами надо:
			у обоих пидоров задать переменную vs_processingRadiosList равную ["tempfreq|1|0"] чтобы они могли говорить и слышать в данную частоту
			После этого на том, кто хочет транслировать в войс вызываем ["tempfreq"] call vs_startTransmith; и он потихоньку начнёт ебашить в рацию а второй его услышит
		
		(ПРОВЕРЕНО)
		Для запуска земленой рации нам надо с вызывающего вызвать ["1"] call vs_startTransmith;


	Остаётся вопрос с дистанциями
		При нажатии тангенты берётся дистанция передачи: vs_transmithDistance. Скорее всего нам надо передавать эту штуку по сети
		tf_globalVolume - глобальная дистанция. выключает вообще всё
		tf_voiceVolume - Громкость (уровень усиления) прямой речи — не влияет на расстояние распространения. Работает аналогично
		
	
# Данные:
При передаче информации об объекте как поддерживающем радиосвязь на земле мы юзаем следующие переменные:
	null (берётся по указателю) - айди рации (уникальная строка)
	текущая частота и кодировка - частота рации (там мы вбиваем любое число)
		частота и кодировка. Может быть дополнено additionalChannel. P.s. из доков может быть больше двух доп.частот
	null - ник игрока (если пустая строка то это радио на земле)
	смещение объектной позиции передачи - позиция (если пустой массив значит радио в игроке)
	громкость - громкость звука
	null - айди транспорта (если не транспорт то ставится "no"). 
		Выдаётся из netid + прочерк + уровень изоляции конфига (tf_isolatedAmount)
		Целиком выглядит как 3:2_40. В сингле netid: singleplayer_40
	null - Высота над уровнем моря. Должно быть больше vs_underwaterRadioDepth. позиция от asl

	Дополнительные флаги радио:
		canHearUnits - может ли радио слышать игроков. Если включено то при подходе к радио оно будет источать звук. Если -1 или null то не источает звук. Если больше >= 0 то будет слышно только при допущении дистанции
		

конечная структура: [float freq, float volume,float canHearUnits, (опционально - если нет смещения то null, pos.x, pos.y, pos.z)]

Так же мы можем срезать кодировку, если данные по частотам и кодировкам держать в спец.карте на сервере

При передаче в рацию на теле игрока:
	